#!/bin/bash
# <bitbar.title>Network Status</bitbar.title>
# <bitbar.version>v1.0</bitbar.version>
# <bitbar.author>Gilgamesh Nootebos</bitbar.author>
# <bitbar.author.github>gilgamez</bitbar.author.github>
# <bitbar.desc>Basic status indicator for internet connectivity<bitbar.desc>
# <bitbar.image>http://i.imgur.com/Vulc3pu.png</bitbar.image>
# <bitbar.dependencies>ping</bitbar.dependencies>
# <bitbar.abouturl>https://github.com/gilgamez/bitbar-plugins</bitbar.abouturl>

IMAGE_UP='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'
IMAGE_DOWN='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'

TARGET=1.1.1.1

ALIVE=$(if ping -o -c 1 -t 1 -n ${TARGET} >/dev/null; then echo true; else echo false; fi)

if $ALIVE
then
    echo "|image=$IMAGE_UP"
    echo ---

    traceroute -w 1 -q 1 ${TARGET} 2>/dev/null | awk  '
        NF > 2 {
            l = length($2)
            m = m > l ? m : l
            ++x
            t[x,1] = $2
            t[x,2]=$4
        }
        END {
            for(i = 1; i <= x; i++) {
                printf "%-" m "s %sms|font=Menlo\n", t[i,1], t[i,2]
            }
        }
    '
else
	echo "|image=$IMAGE_DOWN"
fi
